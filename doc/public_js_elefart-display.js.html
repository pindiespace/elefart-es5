<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>DocStrap Source: public/js/elefart-display.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">DocStrap</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Circle.html">Circle</a>
						</li>
						
						<li>
							<a href="ClassList.html">ClassList</a>
						</li>
						
						<li>
							<a href="Line.html">Line</a>
						</li>
						
						<li>
							<a href="Padding.html">Padding</a>
						</li>
						
						<li>
							<a href="Point.html">Point</a>
						</li>
						
						<li>
							<a href="Polygon.html">Polygon</a>
						</li>
						
						<li>
							<a href="Rect.html">Rect</a>
						</li>
						
						<li>
							<a href="ScreenCircle.html">ScreenCircle</a>
						</li>
						
						<li>
							<a href="ScreenImage.html">ScreenImage</a>
						</li>
						
						<li>
							<a href="ScreenRect.html">ScreenRect</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#$">$</a>
						</li>
						
						<li>
							<a href="global.html#add">add</a>
						</li>
						
						<li>
							<a href="global.html#addChild">addChild</a>
						</li>
						
						<li>
							<a href="global.html#addClassList">addClassList</a>
						</li>
						
						<li>
							<a href="global.html#addEvent">addEvent</a>
						</li>
						
						<li>
							<a href="global.html#addFns">addFns</a>
						</li>
						
						<li>
							<a href="global.html#addToDisplayList">addToDisplayList</a>
						</li>
						
						<li>
							<a href="global.html#bind">bind</a>
						</li>
						
						<li>
							<a href="global.html#canRun">canRun</a>
						</li>
						
						<li>
							<a href="global.html#centerRectInRect">centerRectInRect</a>
						</li>
						
						<li>
							<a href="global.html#checkIfInLayer">checkIfInLayer</a>
						</li>
						
						<li>
							<a href="global.html#checkIfInList">checkIfInList</a>
						</li>
						
						<li>
							<a href="global.html#clone">clone</a>
						</li>
						
						<li>
							<a href="global.html#contains">contains</a>
						</li>
						
						<li>
							<a href="global.html#DisplayList">DisplayList</a>
						</li>
						
						<li>
							<a href="global.html#drawBackground">drawBackground</a>
						</li>
						
						<li>
							<a href="global.html#drawDisplay">drawDisplay</a>
						</li>
						
						<li>
							<a href="global.html#drawFail">drawFail</a>
						</li>
						
						<li>
							<a href="global.html#drawForeground">drawForeground</a>
						</li>
						
						<li>
							<a href="global.html#findChild">findChild</a>
						</li>
						
						<li>
							<a href="global.html#fixScreen">fixScreen</a>
						</li>
						
						<li>
							<a href="global.html#getByClassName">getByClassName</a>
						</li>
						
						<li>
							<a href="global.html#getCenter">getCenter</a>
						</li>
						
						<li>
							<a href="global.html#getElement">getElement</a>
						</li>
						
						<li>
							<a href="global.html#getEnclosingRect">getEnclosingRect</a>
						</li>
						
						<li>
							<a href="global.html#getFilteredImage">getFilteredImage</a>
						</li>
						
						<li>
							<a href="global.html#getForegroundCanvas">getForegroundCanvas</a>
						</li>
						
						<li>
							<a href="global.html#getGameRect">getGameRect</a>
						</li>
						
						<li>
							<a href="global.html#getId">getId</a>
						</li>
						
						<li>
							<a href="global.html#handleKeypress">handleKeypress</a>
						</li>
						
						<li>
							<a href="global.html#handleTouchPoint">handleTouchPoint</a>
						</li>
						
						<li>
							<a href="global.html#init%2520about-screen">init about-screen</a>
						</li>
						
						<li>
							<a href="global.html#init%2520building">init building</a>
						</li>
						
						<li>
							<a href="global.html#init%2520controller">init controller</a>
						</li>
						
						<li>
							<a href="global.html#init%2520dashboard">init dashboard</a>
						</li>
						
						<li>
							<a href="global.html#init%2520display">init display</a>
						</li>
						
						<li>
							<a href="global.html#init%2520dom">init dom</a>
						</li>
						
						<li>
							<a href="global.html#init%2520elefart">init elefart</a>
						</li>
						
						<li>
							<a href="global.html#init%2520exit-screen">init exit-screen</a>
						</li>
						
						<li>
							<a href="global.html#init%2520factory">init factory</a>
						</li>
						
						<li>
							<a href="global.html#init%2520game-screen">init game-screen</a>
						</li>
						
						<li>
							<a href="global.html#init%2520install-screen">init install-screen</a>
						</li>
						
						<li>
							<a href="global.html#init%2520join-screen">init join-screen</a>
						</li>
						
						<li>
							<a href="global.html#init%2520menu-screen">init menu-screen</a>
						</li>
						
						<li>
							<a href="global.html#init%2520scores-screen">init scores-screen</a>
						</li>
						
						<li>
							<a href="global.html#init%2520splash-screen">init splash-screen</a>
						</li>
						
						<li>
							<a href="global.html#intersectRect">intersectRect</a>
						</li>
						
						<li>
							<a href="global.html#isElementVisible">isElementVisible</a>
						</li>
						
						<li>
							<a href="global.html#isNumber">isNumber</a>
						</li>
						
						<li>
							<a href="global.html#isRGB">isRGB</a>
						</li>
						
						<li>
							<a href="global.html#isString">isString</a>
						</li>
						
						<li>
							<a href="global.html#mobileParams">mobileParams</a>
						</li>
						
						<li>
							<a href="global.html#move">move</a>
						</li>
						
						<li>
							<a href="global.html#moveTo">moveTo</a>
						</li>
						
						<li>
							<a href="global.html#pointInside">pointInside</a>
						</li>
						
						<li>
							<a href="global.html#preload">preload</a>
						</li>
						
						<li>
							<a href="global.html#ptInside">ptInside</a>
						</li>
						
						<li>
							<a href="global.html#rectCenterOnPoint">rectCenterOnPoint</a>
						</li>
						
						<li>
							<a href="global.html#rectInRect">rectInRect</a>
						</li>
						
						<li>
							<a href="global.html#remove">remove</a>
						</li>
						
						<li>
							<a href="global.html#removeChild">removeChild</a>
						</li>
						
						<li>
							<a href="global.html#removeEvent">removeEvent</a>
						</li>
						
						<li>
							<a href="global.html#removeFromDisplayList">removeFromDisplayList</a>
						</li>
						
						<li>
							<a href="global.html#removeGameHandlers">removeGameHandlers</a>
						</li>
						
						<li>
							<a href="global.html#run%2520about-screen">run about-screen</a>
						</li>
						
						<li>
							<a href="global.html#run%2520building">run building</a>
						</li>
						
						<li>
							<a href="global.html#run%2520controller">run controller</a>
						</li>
						
						<li>
							<a href="global.html#run%2520dashboard">run dashboard</a>
						</li>
						
						<li>
							<a href="global.html#run%2520display">run display</a>
						</li>
						
						<li>
							<a href="global.html#run%2520dom">run dom</a>
						</li>
						
						<li>
							<a href="global.html#run%2520elefart">run elefart</a>
						</li>
						
						<li>
							<a href="global.html#run%2520exit-screen">run exit-screen</a>
						</li>
						
						<li>
							<a href="global.html#run%2520factory">run factory</a>
						</li>
						
						<li>
							<a href="global.html#run%2520game-screen">run game-screen</a>
						</li>
						
						<li>
							<a href="global.html#run%2520install-screen">run install-screen</a>
						</li>
						
						<li>
							<a href="global.html#run%2520join-screen">run join-screen</a>
						</li>
						
						<li>
							<a href="global.html#run%2520menu-screen">run menu-screen</a>
						</li>
						
						<li>
							<a href="global.html#run%2520scores-screen">run scores-screen</a>
						</li>
						
						<li>
							<a href="global.html#run%2520splash-screen">run splash-screen</a>
						</li>
						
						<li>
							<a href="global.html#scale">scale</a>
						</li>
						
						<li>
							<a href="global.html#screenParams">screenParams</a>
						</li>
						
						<li>
							<a href="global.html#ScreenPoly">ScreenPoly</a>
						</li>
						
						<li>
							<a href="global.html#ScreenSprite">ScreenSprite</a>
						</li>
						
						<li>
							<a href="global.html#setBorderRadius">setBorderRadius</a>
						</li>
						
						<li>
							<a href="global.html#setDimensions">setDimensions</a>
						</li>
						
						<li>
							<a href="global.html#setFill">setFill</a>
						</li>
						
						<li>
							<a href="global.html#setFilter">setFilter</a>
						</li>
						
						<li>
							<a href="global.html#setGameHandlers">setGameHandlers</a>
						</li>
						
						<li>
							<a href="global.html#setGameSize">setGameSize</a>
						</li>
						
						<li>
							<a href="global.html#setGradient">setGradient</a>
						</li>
						
						<li>
							<a href="global.html#setImage">setImage</a>
						</li>
						
						<li>
							<a href="global.html#setLayer">setLayer</a>
						</li>
						
						<li>
							<a href="global.html#setOpacity">setOpacity</a>
						</li>
						
						<li>
							<a href="global.html#setRectPadding">setRectPadding</a>
						</li>
						
						<li>
							<a href="global.html#setStroke">setStroke</a>
						</li>
						
						<li>
							<a href="global.html#showError">showError</a>
						</li>
						
						<li>
							<a href="global.html#showScreenById">showScreenById</a>
						</li>
						
						<li>
							<a href="global.html#toggle">toggle</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: public/js/elefart-display.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/** 
 * @namespace elefart.display
 * @fileoverview elefart.display View
 * HTML5 Canvas drawing routines for game
 */
window.elefart.display = (function () {

	var building,
	dom,
	controller,
	panel,       //game DOM panel
	rect,        //game Rect
	fctx,        //foreground context
	bctx,        //background context
	foreground,  //foreground canvas
	background,  //background canvas
	displayList = {}, //multi-dimensional array with drawing objects
	hotelWalls,  //hotel walls
	hotelSign,   //hotel sign
	spriteBoard, //images of users for animation
	firstTime = true;

/**
 * Enum for types of layers, colors, materials in canvas drawing
 * @readonly
 * @enum {String}
 */
	var LAYERS = {
		BUILDING:"BUILDING",
		SHAFTS:"SHAFTS",
		ELEBACK:"ELEBACK", //back wall of elevators
		ELESPACE1:"ELESPACE1", //places for People to stand
		ELESPACE2:"ELESPCE2",
		ELESPACE3:"ELESPACE3",
		ELESPACE4:"ELESPCE4",
		WALLS:"WALLS", //building walls
		DOORS:"DOORS", //elevator doors
		FLOORS:"FLOORS"  //people and objects in the room floors
	}, //d"isplay list layers. Layers are drawn from 0 outwards
	COLORS = { //flat colors
		BLACK:"rgb(0,0,0)",
		WHITE:"rgb(255,255,255)",
		LIGHT_GREY:"rgb(128,128,128)",
		DARK_GREY:"rgb(40,40,40)"
	},
	MATERIALS = { //gradients

	};

	/**
	 * =========================================
	 * SPECIAL PRELOADS AND UTILITIES
	 * =========================================
	 */

	/** 
	 * @method getGameRect
	 * @description get the current dimensions of the game
	 * NOTE: have to fire it when the screen size changes!
	 * @returns {DOMRect} a DOMRect 
	 * DOMRect {left:0, top:0, right:0, bottom:0, width:0, height:0}
	 */
	function setGameRect () {
		rect = panel.getBoundingClientRect();
	}

	/** 
	  * @method setGameSize
	  * @description set or reset the size of the game drawing at 
	  * start, or if user changes window size
	  */
	function setGameSize () {
		rect = panel.getBoundingClientRect();
		//TODO: recalculate
	}

	/** 
	 * @method preload
	 * @description start game images loading before other JS libraries and 
	 * initialization. Ensures that images are immediately available when the 
	 * game starts.
	 */
	function preload () {

		//hotel wallpaper
		hotelWalls = new Image();
			hotelWalls.onload = function() {
			console.log("display::preload(), loaded background patterns");
		};
		hotelWalls.src = "img/game/wallpaper.png";

		//hotel sign
		hotelSign = new Image();
		hotelSign.onload = function () {
			console.log("display::preload(), loaded hotel sign");
		}
		hotelSign.src = "img/game/hotel_sign.png";

		//character sprites
		spriteBoard = new Image();
		spriteBoard.onload = function () {
			console.log("display::preload(), loaded character sprites");
		}
		spriteBoard.src = "img/game/spriteboard.png";
	}

	/** 
	 * =========================================
	 * CANVAS FILTERS
	 * =========================================
	 */

	/** 
	 * function getPixels 
	 * @description get the pixel RGB(A) data from an image 
	 * @param {HTMLImageElement} img image to return pixel data from 
	 * @param {HTMLCanvasElement} c offscreen &lt;canvas> object to filter in
	 * @return {Array}  array with RGB or RGBA image data 
	 */
	function getPixels (img, c) { 
		c.width = img.width; 
		c.height = img.height; 
		var ctx = c.getContext('2d'); //temporary canvas context
		ctx.drawImage(img);
		return ctx.getImageData(0, 0, c.width, c.height);
	}

	/** 
	 * function filterImageData
	 * @description HTML5 canvas filters applied to image 
	 * put image as first array member, then arguments, then  
	 * call filter function, applying arguments 
	 * @link http://www.html5rocks.com/en/tutorials/canvas/imagefilters/ 
	 * @param {Function} filter the filtering function we apply our image and arguments to 
	 * @param {HTMLImageElement} img the image object 
	 * @param {Array} varArgs additional arguments 
	 * @return {ImageData} image data object returned by  
	 * HTML5CanvasContext.getImageData() 
	 */ 
	function filterImageData (filter, img, varArgs) { 
		var c = document.createElement('canvas'); 
		var args = [getPixels(img, c)]; 
		for (var i = 2; i &lt; arguments.length; i++) { 
			args.push(arguments[i]); 
		}
		return filter.apply(null, args);
	}

	/** 
	 * @method getFilteredImage 
	 * @description get a filtered image as a new JS image object 
	 * @param {HTMLImageElement} img the image object
	 * @param {Function} the filtering function
	 * @param {Array} varArgs additional arguments for the filter, if needed
	 * @returns {HTMLImageElement} image with its pixel data filtered
	 */
	function getFilteredImage (img, filter, varArgs) { 
		var c = document.createElement('canvas'); 
		var args = [getPixels(img, c)]; 
		for (var i = 2; i &lt; arguments.length; i++) { 
			args.push(arguments[i]); 
		}
		var pixels = filter.apply(null, args);
		return (new Image().src = c.toDataURL()); 
	}




	/**
	 * =========================================
	 * DISPLAY LIST
	 * =========================================
	 */

	/** 
	 * @method DisplayList
	 * @description create a new DisplayList
	 */
	function initDisplayList () {
		displayList = {};
		for(var i in LAYERS) {
			displayList[i] = [];
		}
	}

	/** 
	 * @method checkIfInLayer
	 * @description check if an object is in a specific layer in the display list
	 * @param {} obj the object to check
	 * @param {String} layer the LAYERS enum to check
	 * @returns {Number|false} if found, return the index, else false
	 */
	function checkIfInLayer(obj, layer) {
		var len = displayList[layer].length;
		for(var j = 0; j &lt; len; j++) {
			if(obj === displayList[layer][j]) {
				return j;
			}
		}
		return false;
	}
	/** 
	 * @method checkIfInList 
	 * @description check if an object is already in the drawing list
	 * if present, return its position in the array
	 * @param {} obj the object to draw
	 * @returns {Object}false} if found, return its layer and index in layer
	 * otherwise return false
	 */
	function checkIfInList(obj) {
		var numLayers = displayList.length;
		for(var i in LAYERS) {
			var index = checkIfInLayer(obj, i);
			if(index !== false) {
				return {layer:i, index:index};
			}
		}
		return false;
	}

	/** 
	 * @method addToDisplayList
	 * @description add an object to the visual display list
	 * @param {Point|Line|Rect|Circle|Polygon|Sprite} obj the object to draw
	 * @param {Number} layer the layer to draw in
	 */
	function addToDisplayList (obj, layer) {
		displayList[layer].push(obj);
	}

	/** 
	 * @method removeFromDisplayList
	 * @description remove an object from drawing display list
	 * @param {Point|Line|Rect|Circle|Polygon|SpriteBoard} obj the object to draw
	 * @param {Number} layer the layer to draw in (optional)
	 */
	function removeFromDisplayList (obj, layer) {
		var pos;
		if(layer) {
			pos = checkIfInLayer(obj);
			if(pos) {
				displayList[layer].splice(pos, 1); //remove element
			}
		}
		else {
			pos = checkIfInList(obj);
			if(pos) {
				displayList[pos.layer].splice(pos, 1);
			}
		}
	}

	/**
	 * =========================================
	 * DRAW BACKGROUND CANVAS
	 * =========================================
	 */

	/** 
	 * @method getForegroundCanvas
	 * @description get a reference to the foreground canvas
	 */
	function getBackgroundCanvas () {
		if(firstTime) return false;
		return background;
	}

	/** 
	 * @method drawBackground
	 * @description draw the background for a game in an underlying canvas layer
	 * - some building layers including the Sky and Walls
	 * - additional background objects
	 */
	function drawBackground () {

		bctx.save();
		//yellow background
		bctx.fillStyle = "rgba(248, 237, 29, 1.0)";
		bctx.rect(0, 0, rect.width, rect.height);
		bctx.fill();
		bctx.restore();

	}

	/**
	 * =========================================
	 * DRAW FOREGROUND CANVAS
	 * =========================================
	 */

	/** 
	 * @method getForegroundCanvas
	 * @description get a reference to the foreground canvas
	 */
	function getForegroundCanvas () {
		if(firstTime) return false;
		return foreground;
	}


	/** 
	 * @method drawForeground
	 * @description draw the foreground for the display
	 */
	function drawForeground () {

		fctx.save();

		//clear the foreground
		fctx.clearRect(0, 0, foreground.width, foreground.height);

		//draw user interface

		//restore
		fctx.restore();
	}

	/**
	 * =========================================
	 * DRAW DISPLAY
	 * =========================================
	 */

	/** 
	 * @method drawDisplay
	 * @description draw the entire game, (background, foreground, 
	 * user controls) as necessary
	 */
	function drawDisplay () {

		drawForeground();

	}

	/**
	 * =========================================
	 * DRAW FAIL SCREEN
	 * =========================================
	 */

	/** 
	 * @method drawFail
	 * @description if we can't run HTML5 canvas, put up an 
	 * error and exit screen for the user
	 */
	function drawFail () {
		//TODO: need to draw a fail screen with 
		//DOM methods
		console.log("elefart:" + elefart);
		console.log("elefart features:" + elefart.features);
		console.log("elefart createelement:" + elefart.features.createelement);
		console.log("elefart features ok:" + elefart.features.ok);
		elefart.showError("can't load canvas, draw fail screen here");
	}

	/**
	 * =========================================
	 * INIT AND RUN
	 * =========================================
	 */


	/** 
	 * @method init display
	 * @description initialize the HTML5 canvas display.
	 */
	function init () {

		//if we can't run canvas, fallback to DOM error message
		if(!elefart.features || !elefart.features.ok) {
			drawFail();
			return;
		}

		//assign shared objects
		building = elefart.building,
		controller = elefart.controller;

		//start images loading
		preload();

		//initialize our display list
		initDisplayList();

		//initialize canvas for foreground
		foreground = document.createElement('canvas');
		fctx = foreground.getContext("2d");
		foreground.id = 'game-foreground';

		//initialize canvas for background
		background = document.createElement('canvas');
		bctx = background.getContext("2d");
		background.id = 'game-background';

		//set init flag to false
		firstTime = false;
	}

	/** 
	 * @method run display
	 * @description turn on the game canvas so it can be drawn to.
	 */
	function run (gamePanel) {
		if(firstTime) {
			init();
		}
		console.log("in display.run");

		//the panel is assigned by elefart.screens['screen-game']
		panel = gamePanel;

		//set the dimensions of our game from the panel (also called on resize event)
		setGameRect();

		if(foreground &amp;&amp; background &amp;&amp; panel) {

			background.width = rect.width;
			background.height = rect.height;
			foreground.width = rect.width;
			foreground.height = rect.height;

			panel.appendChild(background);
			panel.appendChild(foreground);

			//we draw once here, before letting elefart.controller take over
			drawBackground();
			drawDisplay();
		}
		else {
			console.log("ERROR: failed to make canvas objects, foreground:" + 
				foreground + " background:" + 
				background + " panel:" + panel
				);
		}
	}

	//returned object
	return {
		LAYERS:LAYERS,
		COLORS:COLORS,
		MATERIALS:MATERIALS,
		setGameRect:setGameRect,
		getBackgroundCanvas:getBackgroundCanvas,
		getForegroundCanvas:getForegroundCanvas,
		addToDisplayList:addToDisplayList,
		removeFromDisplayList:removeFromDisplayList,
		drawDisplay:drawDisplay,
		init:init,
		run:run
	};

})();</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		DocStrap Copyright © 2012-2014 The contributors to the JSDoc3 and DocStrap projects.
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha11</a>
		on Sun Dec 21st 2014 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
